<!--<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Réinitialiser le mot de passe - jëndUp</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 20px;
    }

    .reset-container {
      background: white;
      border-radius: 20px;
      padding: 40px 30px;
      width: 100%;
      max-width: 450px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      text-align: center;
      margin-bottom: 25px;
    }

    .logo i {
      font-size: 2.5rem;
      color: #4361ee;
      background: #e8f0fe;
      padding: 15px;
      border-radius: 50%;
    }

    h2 {
      color: #333;
      font-size: 1.8rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .password-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-wrapper input {
      width: 100%;
      padding: 15px 50px 15px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s;
      background: #f8f9fa;
    }

    .password-wrapper input:focus {
      border-color: #4361ee;
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
      background: white;
    }

    .password-wrapper input::placeholder {
      color: #aaa;
    }

    .toggle-password {
      position: absolute;
      right: 15px;
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 1.2rem;
      transition: color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
    }

    .toggle-password:hover {
      color: #4361ee;
    }

    .password-strength {
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .strength-bar {
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      margin: 5px 0;
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0;
      transition: width 0.3s, background 0.3s;
    }

    .strength-fill.weak {
      width: 33%;
      background: #dc3545;
    }

    .strength-fill.medium {
      width: 66%;
      background: #ffc107;
    }

    .strength-fill.strong {
      width: 100%;
      background: #28a745;
    }

    .strength-text {
      color: #666;
    }

    .requirements {
      margin-top: 10px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 12px;
      font-size: 0.85rem;
    }

    .requirement-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: #666;
    }

    .requirement-item i {
      font-size: 0.9rem;
    }

    .requirement-item.valid {
      color: #28a745;
    }

    .requirement-item.invalid {
      color: #666;
    }

    .match-message {
      margin-top: 8px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .match-message.success {
      color: #28a745;
    }

    .match-message.error {
      color: #dc3545;
    }

    button[type="submit"] {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #4361ee, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }

    button[type="submit"]:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
    }

    button[type="submit"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #message {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.95rem;
    }

    #message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    #message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .login-link {
      text-align: center;
      margin-top: 20px;
    }

    .login-link a {
      color: #4361ee;
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.3s;
    }

    .login-link a:hover {
      color: #3451d1;
      text-decoration: underline;
    }

    @media (max-width: 480px) {
      .reset-container {
        padding: 30px 20px;
      }

      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

<div class="reset-container">
  <div class="logo">
    <i class="fas fa-exchange-alt"></i>
  </div>
  
  <h2>Réinitialiser le mot de passe</h2>
  <div class="subtitle">Choisissez un nouveau mot de passe sécurisé</div>

  <form id="reset-form">
    <div class="form-group">
      <label style="display: block; margin-bottom: 8px; color: #555; font-weight: 500;">Nouveau mot de passe</label>
      <div class="password-wrapper">
        <input 
          type="password" 
          id="password" 
          placeholder="Entrez votre nouveau mot de passe" 
          required 
        />
        <button 
          type="button" 
          class="toggle-password" 
          onclick="togglePassword('password', 'toggle-icon-1')"
          aria-label="Afficher/masquer le mot de passe"
        >
          <i id="toggle-icon-1" class="far fa-eye"></i>
        </button>
      </div>
      
      <div class="password-strength" id="strength-container" style="display: none;">
        <div class="strength-bar">
          <div class="strength-fill" id="strength-fill"></div>
        </div>
        <span class="strength-text" id="strength-text">Faible</span>
      </div>

      <div class="requirements">
        <div class="requirement-item" id="req-length">
          <i class="fas fa-times-circle"></i>
          <span>Au moins 6 caractères</span>
        </div>
        <div class="requirement-item" id="req-number">
          <i class="fas fa-times-circle"></i>
          <span>Au moins 1 chiffre</span>
        </div>
        <div class="requirement-item" id="req-lower">
          <i class="fas fa-times-circle"></i>
          <span>Au moins 1 lettre minuscule</span>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label style="display: block; margin-bottom: 8px; color: #555; font-weight: 500;">Confirmer le mot de passe</label>
      <div class="password-wrapper">
        <input 
          type="password" 
          id="confirm-password" 
          placeholder="Confirmez votre mot de passe" 
          required 
        />
        <button 
          type="button" 
          class="toggle-password" 
          onclick="togglePassword('confirm-password', 'toggle-icon-2')"
          aria-label="Afficher/masquer la confirmation"
        >
          <i id="toggle-icon-2" class="far fa-eye"></i>
        </button>
      </div>
      
      <div id="match-message" class="match-message"></div>
    </div>

    <button type="submit" id="submit-btn" disabled>
      <i class="fas fa-key me-2"></i>Modifier le mot de passe
    </button>
  </form>

  <div id="message"></div>
  
  <div class="login-link">
    <a href="connexion.html">
      <i class="fas fa-arrow-left me-1"></i>Retour à la connexion
    </a>
  </div>
</div>

<script>
// Récupérer le token de l'URL
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

// Vérifier si le token existe
if (!token) {
  document.getElementById('message').innerHTML = `
    <div style="color: #dc3545;">
      <i class="fas fa-exclamation-triangle me-2"></i>
      Lien de réinitialisation invalide ou expiré
    </div>
  `;
  document.getElementById('submit-btn').disabled = true;
}

// ===== FONCTIONS DE MASQUAGE/DÉMASQUAGE =====
function togglePassword(inputId, iconId) {
  const input = document.getElementById(inputId);
  const icon = document.getElementById(iconId);
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.className = 'far fa-eye-slash';
  } else {
    input.type = 'password';
    icon.className = 'far fa-eye';
  }
}

// ===== VALIDATION EN TEMPS RÉEL =====
const passwordInput = document.getElementById('password');
const confirmInput = document.getElementById('confirm-password');
const submitBtn = document.getElementById('submit-btn');
const strengthContainer = document.getElementById('strength-container');
const strengthFill = document.getElementById('strength-fill');
const strengthText = document.getElementById('strength-text');

// Éléments des exigences
const reqLength = document.getElementById('req-length');
const reqNumber = document.getElementById('req-number');
const reqLower = document.getElementById('req-lower');
const matchMessage = document.getElementById('match-message');

function checkPasswordStrength(password) {
  const hasLength = password.length >= 6;
  const hasNumber = /[0-9]/.test(password);
  const hasLower = /[a-z]/.test(password);
  
  // Mettre à jour les icônes des exigences
  updateRequirement(reqLength, hasLength);
  updateRequirement(reqNumber, hasNumber);
  updateRequirement(reqLower, hasLower);
  
  // Calculer la force
  const score = (hasLength ? 1 : 0) + (hasNumber ? 1 : 0) + (hasLower ? 1 : 0);
  
  if (password.length === 0) {
    strengthContainer.style.display = 'none';
  } else {
    strengthContainer.style.display = 'block';
    
    if (score <= 1) {
      strengthFill.className = 'strength-fill weak';
      strengthText.textContent = 'Faible';
      strengthText.style.color = '#dc3545';
    } else if (score === 2) {
      strengthFill.className = 'strength-fill medium';
      strengthText.textContent = 'Moyen';
      strengthText.style.color = '#ffc107';
    } else {
      strengthFill.className = 'strength-fill strong';
      strengthText.textContent = 'Fort';
      strengthText.style.color = '#28a745';
    }
  }
  
  return { hasLength, hasNumber, hasLower };
}

function updateRequirement(element, isValid) {
  const icon = element.querySelector('i');
  if (isValid) {
    element.classList.add('valid');
    element.classList.remove('invalid');
    icon.className = 'fas fa-check-circle';
  } else {
    element.classList.remove('valid');
    element.classList.add('invalid');
    icon.className = 'fas fa-times-circle';
  }
}

function checkPasswordsMatch() {
  const password = passwordInput.value;
  const confirm = confirmInput.value;
  
  if (confirm.length === 0) {
    matchMessage.innerHTML = '';
    return true;
  }
  
  if (password === confirm) {
    matchMessage.innerHTML = '<i class="fas fa-check-circle me-1"></i>Les mots de passe correspondent';
    matchMessage.className = 'match-message success';
    return true;
  } else {
    matchMessage.innerHTML = '<i class="fas fa-exclamation-circle me-1"></i>Les mots de passe ne correspondent pas';
    matchMessage.className = 'match-message error';
    return false;
  }
}

function validateForm() {
  const password = passwordInput.value;
  
  const { hasLength, hasNumber, hasLower } = checkPasswordStrength(password);
  const match = checkPasswordsMatch();
  
  // Activer le bouton seulement si toutes les conditions sont remplies
  const isValid = hasLength && hasNumber && hasLower && match && password.length > 0;
  submitBtn.disabled = !isValid;
  
  return isValid;
}

// Événements de validation en temps réel
passwordInput.addEventListener('input', validateForm);
confirmInput.addEventListener('input', validateForm);

// ===== SOUMISSION DU FORMULAIRE =====
document.getElementById("reset-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const password = document.getElementById("password").value;
  const message = document.getElementById("message");

  // Désactiver le bouton pendant l'envoi
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Traitement...';

  try {
    const res = await fetch(
      "https://kkgguofgpzdlgtbzvnzn.supabase.co/functions/v1/update-password",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, password })
      }
    );

    const data = await res.json();

    /*if (res.ok) {
      message.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        ${data.message || 'Mot de passe modifié avec succès !'}
      `;
      message.className = 'success';
      
      // Rediriger après 2 secondes
      setTimeout(() => {
        window.location.href = 'connexion.html?reset=success';
      }, 2000);
    } else {
      message.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        ${data.error || 'Une erreur est survenue'}
      `;
      message.className = 'error';
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fas fa-key me-2"></i>Modifier le mot de passe';
    }*/

    if (data.error) {
      message.innerHTML = `<i class="fas fa-exclamation-triangle me-2"></i>${data.error}`;
      message.className = 'error';
    } else {
      message.innerHTML = `<i class="fas fa-check-circle me-2"></i>${data.message || 'Mot de passe modifié avec succès !'}`;
      message.className = 'success';

      // Redirection après succès
      setTimeout(() => {
        window.location.href = 'connexion.html?reset=success';
      }, 2000);
    }
  } catch (error) {
    console.error('Erreur:', error);
    message.innerHTML = `
      <i class="fas fa-exclamation-triangle me-2"></i>
      Erreur de connexion au serveur
    `;
    message.className = 'error';
    submitBtn.disabled = false;
    submitBtn.innerHTML = '<i class="fas fa-key me-2"></i>Modifier le mot de passe';
  }
});
</script>

</body>
</html>-->






<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Réinitialiser le mot de passe - jëndUp</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .reset-container{
      background:white;
      border-radius:20px;
      padding:40px 30px;
      width:100%;
      max-width:450px;
      box-shadow:0 20px 40px rgba(0,0,0,0.2);
      animation:slideUp .5s ease-out;
    }

    @keyframes slideUp{
      from{opacity:0;transform:translateY(30px);}
      to{opacity:1;transform:translateY(0);}
    }

    .logo{text-align:center;margin-bottom:25px;}
    .logo i{
      font-size:2.5rem;
      color:#4361ee;
      background:#e8f0fe;
      padding:15px;
      border-radius:50%;
    }

    h2{
      color:#333;
      font-size:1.8rem;
      font-weight:600;
      text-align:center;
      margin-bottom:10px;
    }

    .subtitle{
      color:#666;
      text-align:center;
      margin-bottom:30px;
      font-size:.95rem;
    }

    .form-group{margin-bottom:20px;}

    .password-wrapper{
      position:relative;
      display:flex;
      align-items:center;
    }

    .password-wrapper input{
      width:100%;
      padding:15px 50px 15px 15px;
      border:2px solid #e0e0e0;
      border-radius:12px;
      font-size:1rem;
      background:#f8f9fa;
      transition:.3s;
    }

    .password-wrapper input:focus{
      border-color:#4361ee;
      outline:none;
      box-shadow:0 0 0 3px rgba(67,97,238,.1);
      background:white;
    }

    .toggle-password{
      position:absolute;
      right:15px;
      background:none;
      border:none;
      color:#666;
      cursor:pointer;
      font-size:1.2rem;
    }

    .toggle-password:hover{color:#4361ee;}

    button[type="submit"]{
      width:100%;
      padding:15px;
      background:linear-gradient(135deg,#4361ee,#764ba2);
      color:white;
      border:none;
      border-radius:12px;
      font-size:1.1rem;
      font-weight:600;
      cursor:pointer;
      transition:.3s;
      margin-top:20px;
      box-shadow:0 5px 15px rgba(67,97,238,.3);
    }

    button[type="submit"]:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(67,97,238,.4);
    }

    #message{
      margin-top:20px;
      padding:12px;
      border-radius:8px;
      text-align:center;
      font-size:.95rem;
    }

    .success{
      background:#d4edda;
      color:#155724;
      border:1px solid #c3e6cb;
    }

    .error{
      background:#f8d7da;
      color:#721c24;
      border:1px solid #f5c6cb;
    }
  </style>
</head>

<body>

<div class="reset-container">
  <div class="logo">
    <i class="fas fa-exchange-alt"></i>
  </div>

  <h2>Réinitialiser le mot de passe</h2>
  <div class="subtitle">Entrez votre nouveau mot de passe</div>

  <form id="reset-form">
    <div class="form-group">
      <div class="password-wrapper">
        <input type="password" id="password" placeholder="Nouveau mot de passe" required/>
        <button type="button" class="toggle-password" onclick="togglePassword()">
          <i id="toggle-icon" class="far fa-eye"></i>
        </button>
      </div>
    </div>

    <button type="submit">
      <i class="fas fa-key"></i> Modifier le mot de passe
    </button>
  </form>

  <p id="message"></p>
</div>

<script>
function togglePassword(){
  const input=document.getElementById("password")
  const icon=document.getElementById("toggle-icon")

  if(input.type==="password"){
    input.type="text"
    icon.className="far fa-eye-slash"
  }else{
    input.type="password"
    icon.className="far fa-eye"
  }
}

/* ===== TON CODE EXACT SANS MODIFICATION ===== */

const params = new URLSearchParams(window.location.search)
const token = params.get("token")

document.getElementById("reset-form")
.addEventListener("submit", async (e) => {
  e.preventDefault()

  const password = document.getElementById("password").value
  const message = document.getElementById("message")

  try {
    const res = await fetch(
      "https://kkgguofgpzdlgtbzvnzn.supabase.co/functions/v1/update-password",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, password })
      }
    )

    const data = await res.json()
    message.textContent = data.message || data.error

    // ✅ Rediriger UNIQUEMENT si succès réel
    if (res.ok && !data.error) {
      setTimeout(() => {
        window.location.href = 'connexion.html?reset=success';
      }, 2000);
    }

  } catch (error) {
    message.textContent = "Erreur serveur ou problème réseau."
    console.error("Erreur :", error)
  }
})
</script>

</body>
</html>